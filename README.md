# Кредитный скоринг на данных кредитных историй.

В данном репозитории находится проект по кредитному скорингу. Построена PD модель оценки вероятности дефолта, основанная на рекуррентной нейронной сети. Реализованы пайплайны препроцессинга данных, тренировки и инференса модели.

## Постановка задачи
Кредитный скоринг – основная задача, возникающая в сфере финтеха, в которой
используются методы машинного обучения. В процессе него определяется
платежеспособность клиента, который подает заявку на кредит. Модели скоринга
используют знания о предыдущих операциях клиента и оценивают вероятность дефолта.
На основе нее принимается решение о выдаче либо невыдаче кредита. Все это
позволяет банку выдавать кредит наиболее надежным людям, и минимизировать
финансовые риски.

### Формат входных и выходных данных
Входные данные содержат кредитные истории по различным клиентам. В каждой строке представлена информация о предыдущей заявке клиента на кредит, к примеру, размер суммы, дата открытия и закрытия, информация о просрочках и так далее. Целевая переменная является бинарной: 0 обозначает закрытие кредита, 1 обозначает дефолт.

### Метрики
В данной задаче основной метрикой считается ROC-AUC. Выбор метрики обусловлен типом задачи (классификация) и имеющимся дисбалансом классов. Планируется достичь ROC-AUC 0.72 и выше.

### Валидация
Данные уже поделены на тренировку и валидацию. Проведение кросс-валидации в условиях большой выборки данных будет слишком затратно по времени.

### Данные
Данные были взяты из соревнования Альфа-Банка по анализу данных. Они представлены в виде нескольких Parquet файлов (10 для тренировки и 2 для валидации). Ключевые проблемы – большой объем и невозможность восстановить правило шифровки (границы бакетов). Также в целевой переменной присутствует ярко выраженный дисбаланс (дефолтов гораздо меньше чем закрытий).

Подробное описание файлов и полей датасета соревнования находится [по данной ссылке](https://disk.yandex.ru/d/K1cxGrw1KDmBsg)

## Моделирование

Данные представлены в виде временных рядов (все транзакции даны по возрастанию даты), значит, можно использовать рекуррентные нейронные сети. В данном проекте для построения модели предусмотрена возможность выбора типа рекуррентного блока (RNN, GRU либо LSTM), для сравнения метрик качества предсказания различных подходов между собой.

## Описание структуры репозитория
Данный репозиторий состоит из следующих директорий:
* conf - конфигурации
* credit_scoring - модуль с кодом модели в виде python-файлов
* data - данные для тренировки, валидации и инференса
* model_checkpoints - чекпоинты обученных моделей (сохраняется лучший среди всех эпох по валидационной метрике и последний)

и файлов:
* pyproject.toml - перечень зависимостей проекта, используется для установки с помощью uv
* uv.lock - служебный файл утилиты uv

### Описание структуры директории с данными
Директорию с данными необходимо организовать по следующей структуре:
```
<data_root_directory>/
...<train_data_directory>/
......<train_file_1>
......<train_file_2>
...<test_data_directory>/
......<test_file_1>
......<test_file_2>
...<train_target_file>
```
Важное условие: файлы в директориях <train_data_directory> и <test_data_directory> должны быть одного из двух расширений `.pq` либо `.csv`, файл <train_target_file> может быть только расширения `.csv`


В конфигурациях задается дефолтная структура, которую можно настраивать под свои нужды. Задавать можно либо в папке `conf`, либо при помощи флагов в train и infer пайплайнах (описано далее). При стандартной конфигурации директория с данными помещается в корневую папку проекта и выглядит следующим образом:
```
data/
...train_data/
......<train_file_1>
......<train_file_2>
...test_data/
......<test_file_1>
......<test_file_2>
...train_target.csv
```

## Инструкция по работе с моделью

### Установка (Setup)
Для подготовки виртуального окружения и установки зависимостей необходимо иметь установленную в системе утилиту uv. Инструкция по настройке утилиты находится на официальном сайте ([ссылка](https://docs.astral.sh/uv/getting-started/installation/))

Затем необходимо склонировать данный репозиторий:

```
git clone https://github.com/presudozwerg/credit-scoring-on-credit-history.git
cd credit-scoring-on-credit-history
```

Создать и активировать виртуальное окружение:

```
uv venv credit_scoring --python 3.11
source .venv/bin/activate
```

Установить все зависимости из файла `pyproject.toml`:

```
uv sync
```

### Обучение (Train)
Пайплайн тренировки состоит из трех частей:
* Препроцессинг данных. Все файлы в train директории загружаются в оперативную память и объединяются в один большой датафрейм. Затем считывается файл с таргетом и данные разбиваются на тренировочную и валидационную части.
* Обучение модели на обработанных данных.
* Выгрузка чекпоинта модели в директорию `model_checkpoints`.

Для запуска обучения нужно запустить команду:
```
python credit_scoring/train.py <flags>
```

Параметры тренировки можно задать в директории conf (расширенный набор параметорв), либо добавив флаги в команду выше (базовый набор параметров). Описание доступных флагов можно вывести командой:
```
python credit_scoring/train.py --help
```

### Подготовка к использованию (Production preparation)
пока не реализовано

### Предсказание (Infer)
Пайплайн инференса состоит из трех частей:
* Препроцессинг данных. Все файлы в test директории загружаются в оперативную память и объединяются в один большой датафрейм.
* Загрузка чекпоинта обученной модели из директории `model_checkpoints`.
* Инференс модели на обработанных данных и выгрузка файла с предсказаниями.

Для запуска инференса нужно прописать команду:
```
python credit_scoring/infer.py <flags>
```

С помощью флагов можно задавать пути к директории с данными для инференса и к файлу с предсказаниями. Подробное описание доступных флагов можно вывести командой:
```
python credit_scoring/infer.py --help
```


